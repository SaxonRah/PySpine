# PySpine JSON Output Formats

This document outlines the structure of each JSON file generated by PySpine editors for implementing custom loaders.

## 1. Sprite Project (`sprite_project.json`)

Generated by: **Sprite Sheet Editor**

```json
{
  "sprite_sheet_path": "path/to/spritesheet.png",
  "sprites": {
    "sprite_1": {
      "name": "sprite_1",
      "x": 0,
      "y": 0,
      "width": 64,
      "height": 64,
      "origin_x": 0.5,
      "origin_y": 0.5
    },
    "sprite_2": {
      "name": "sprite_2", 
      "x": 64,
      "y": 0,
      "width": 32,
      "height": 48,
      "origin_x": 0.5,
      "origin_y": 1.0
    }
  }
}
```

### Sprite Object Structure
| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Unique sprite identifier |
| `x` | integer | Left position in sprite sheet (pixels) |
| `y` | integer | Top position in sprite sheet (pixels) |
| `width` | integer | Sprite width (pixels) |
| `height` | integer | Sprite height (pixels) |
| `origin_x` | float | Horizontal origin (0.0-1.0, relative to sprite) |
| `origin_y` | float | Vertical origin (0.0-1.0, relative to sprite) |

## 2. Bone Project (`bone_project.json`)

Generated by: **Bone Editor**

```json
{
  "bones": {
    "root_bone": {
      "name": "root_bone",
      "x": 100.0,
      "y": 200.0,
      "length": 80.0,
      "angle": 0.0,
      "parent": null,
      "parent_attachment_point": "end",
      "children": ["child_bone_1", "child_bone_2"],
      "layer": "middle",
      "layer_order": 0
    },
    "child_bone_1": {
      "name": "child_bone_1",
      "x": 180.0,
      "y": 200.0,
      "length": 60.0,
      "angle": 45.0,
      "parent": "root_bone",
      "parent_attachment_point": "end",
      "children": [],
      "layer": "front",
      "layer_order": 1
    }
  }
}
```

### Bone Object Structure
| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Unique bone identifier |
| `x` | float | World X position of bone start |
| `y` | float | World Y position of bone start |
| `length` | float | Bone length in pixels |
| `angle` | float | Bone rotation in degrees |
| `parent` | string\|null | Parent bone name (null for root bones) |
| `parent_attachment_point` | string | Where this bone attaches to parent: `"start"` or `"end"` |
| `children` | string[] | Array of child bone names |
| `layer` | string | Rendering layer: `"behind"`, `"middle"`, or `"front"` |
| `layer_order` | integer | Order within layer (higher = front) |

## 3. Sprite Attachment Config (`sprite_attachment_config.json`)

Generated by: **Sprite Attachment Editor**

```json
{
  "sprite_sheet_path": "path/to/spritesheet.png",
  "sprites": {
    "head": {
      "name": "head",
      "x": 0,
      "y": 0,
      "width": 32,
      "height": 32,
      "origin_x": 0.5,
      "origin_y": 0.5
    }
  },
  "bones": {
    "neck": {
      "name": "neck",
      "x": 100.0,
      "y": 100.0,
      "length": 50.0,
      "angle": 90.0,
      "parent": null,
      "parent_attachment_point": "end",
      "children": [],
      "layer": "middle",
      "layer_order": 0
    }
  },
  "sprite_instances": {
    "head_1": {
      "id": "head_1",
      "sprite_name": "head",
      "bone_name": "neck",
      "offset_x": 0.0,
      "offset_y": -10.0,
      "offset_rotation": 0.0,
      "scale": 1.0,
      "bone_attachment_point": "end"
    }
  }
}
```

### Sprite Instance Object Structure
| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Unique instance identifier |
| `sprite_name` | string | Reference to sprite in `sprites` object |
| `bone_name` | string\|null | Bone this instance is attached to |
| `offset_x` | float | X offset from bone attachment point |
| `offset_y` | float | Y offset from bone attachment point |
| `offset_rotation` | float | Rotation offset in degrees |
| `scale` | float | Scale multiplier (1.0 = normal size) |
| `bone_attachment_point` | string | Bone attachment point: `"start"` or `"end"` |

## 4. Animation Project (`bone_animation.json`)

Generated by: **Animation Editor**

```json
{
  "duration": 5.0,
  "fps": 30,
  "original_bone_positions": {
    "root_bone": [100.0, 200.0, 0.0],
    "arm_bone": [150.0, 180.0, 45.0]
  },
  "sprite_instances": {
    "torso_1": {
      "id": "torso_1",
      "sprite_name": "torso",
      "bone_name": "root_bone",
      "offset_x": 0.0,
      "offset_y": 0.0,
      "offset_rotation": 0.0,
      "scale": 1.0,
      "bone_attachment_point": "start"
    }
  },
  "bone_tracks": {
    "root_bone": {
      "keyframes": [
        {
          "time": 0.0,
          "transform": {
            "x": 0.0,
            "y": 0.0,
            "rotation": 0.0,
            "scale": 1.0
          },
          "interpolation": "linear",
          "sprite_instance_id": null
        },
        {
          "time": 2.5,
          "transform": {
            "x": 50.0,
            "y": -20.0,
            "rotation": 15.0,
            "scale": 1.0
          },
          "interpolation": "ease_in_out",
          "sprite_instance_id": null
        }
      ]
    }
  }
}
```

### Animation Root Structure
| Field | Type | Description |
|-------|------|-------------|
| `duration` | float | Total animation duration in seconds |
| `fps` | integer | Frames per second for playback |
| `original_bone_positions` | object | Original bone positions before animation |
| `sprite_instances` | object | Sprite instances (same as attachment config) |
| `bone_tracks` | object | Animation data per bone |

### Original Bone Positions
```json
"original_bone_positions": {
  "bone_name": [x, y, angle]
}
```
- `x`, `y`: Original world position (float)
- `angle`: Original rotation in degrees (float)

### Bone Track Structure
```json
"bone_name": {
  "keyframes": [...]
}
```

### Keyframe Object Structure
| Field | Type | Description |
|-------|------|-------------|
| `time` | float | Time in seconds when keyframe occurs |
| `transform` | object | Transform values at this time |
| `interpolation` | string | Interpolation type to next keyframe |
| `sprite_instance_id` | string\|null | Optional sprite change at this keyframe |

### Transform Object Structure
| Field | Type | Description |
|-------|------|-------------|
| `x` | float | X offset from original bone position |
| `y` | float | Y offset from original bone position |
| `rotation` | float | Rotation offset in degrees |
| `scale` | float | Scale multiplier (1.0 = normal) |

### Interpolation Types
- `"linear"` - Linear interpolation
- `"ease_in"` - Cubic ease in (slow start)
- `"ease_out"` - Cubic ease out (slow end)
- `"ease_in_out"` - Cubic ease in and out
- `"bezier"` - Smooth bezier curve

## Implementation Notes

### Coordinate System
- **Origin**: Top-left corner (0,0)
- **X-axis**: Increases to the right
- **Y-axis**: Increases downward
- **Rotation**: Degrees, clockwise positive
- **Sprite Origins**: Relative (0.0-1.0), where (0.5, 0.5) is center

### Loading Order for Full Implementation
1. Load sprite project to get sprite definitions
2. Load bone project to get skeleton structure  
3. Load attachment config to get sprite-to-bone bindings
4. Load animation to get keyframe data

### Animation Calculation
```pseudocode
for each bone:
    original_pos = original_bone_positions[bone_name]
    animation_offset = interpolate_keyframes(bone_tracks[bone_name], current_time)
    final_pos = original_pos + animation_offset
    
    if bone.parent:
        final_pos = transform_by_parent_hierarchy(final_pos, parent_transforms)
```

### Sprite Rendering Calculation
```pseudocode
for each sprite_instance:
    bone = bones[sprite_instance.bone_name]
    attachment_point = calculate_attachment_point(bone, sprite_instance.bone_attachment_point)
    
    sprite_world_pos = attachment_point + sprite_instance.offset
    sprite_rotation = bone.rotation + sprite_instance.offset_rotation
    sprite_scale = bone.scale * sprite_instance.scale
```

This format allows for complete reconstruction of PySpine projects in any engine or framework that can parse JSON and render 2D graphics.
